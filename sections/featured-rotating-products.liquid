<div id="product-slider">
    <p>Number of products: {{ collections.all.products.size }}</p>
    <div class="slider-container">
        <div class="product-item left"></div>
        <div class="product-item active"></div>
        <div class="product-item right"></div>
    </div>
</div>

<style>
    #product-slider {
        text-align: center;
        position: relative;
        max-width: 900px;
        margin: 0 auto;
        overflow: hidden;
    }

    .slider-container {
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        width: 100%;
    }

    .product-item {
        width: 300px;
        height: 400px;
        text-align: center;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #f9f9f9;
        margin: 0 10px;
        cursor: pointer;
        transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
        position: absolute;
        top: 0;
    }

    .product-item img {
        max-width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 10px;
    }

    .product-item p {
        margin: 10px 0;
    }

    .btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
    }

    /* Початкові позиції */
    .left {
        transform: translateX(-120%) scale(0.8);
        opacity: 0.5;
        z-index: 1;
    }

    .active {
        transform: translateX(0) scale(1);
        opacity: 1;
        z-index: 2;
    }

    .right {
        transform: translateX(120%) scale(0.8);
        opacity: 0.5;
        z-index: 1;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const sliderContainer = document.querySelector('.slider-container');
        const productItems = document.querySelectorAll('.product-item');
        const productsData = {{ collections.all.products | json }};
        let currentIndex = 0;
        let autoSlideInterval;

        function updateSlider() {
            productItems.forEach(item => item.innerHTML = ''); // Очищення
            let leftIndex = (currentIndex - 1 + productsData.length) % productsData.length;
            let activeIndex = currentIndex;
            let rightIndex = (currentIndex + 1) % productsData.length;

            // Ліва картка
            let leftProduct = productsData[leftIndex];
            if (leftProduct) {
                const leftItem = productItems[0];
                leftItem.className = 'product-item left';
                leftItem.innerHTML = `
                    <img src="${leftProduct.featured_image || 'https://via.placeholder.com/200'}" alt="${leftProduct.title}">
                    <p>${leftProduct.title}</p>
                `;
            }

            // Центральна картка
            let activeProduct = productsData[activeIndex];
            if (activeProduct) {
                const activeItem = productItems[1];
                activeItem.className = 'product-item active';
                activeItem.innerHTML = `
                    <img src="${activeProduct.featured_image || 'https://via.placeholder.com/200'}" alt="${activeProduct.title}">
                    <p>${activeProduct.title}</p>
                    <p>${activeProduct.price}</p>
                    <a href="${activeProduct.url}" class="btn btn-primary">View Product</a>
                `;
            }

            // Права картка
            let rightProduct = productsData[rightIndex];
            if (rightProduct) {
                const rightItem = productItems[2];
                rightItem.className = 'product-item right';
                rightItem.innerHTML = `
                    <img src="${rightProduct.featured_image || 'https://via.placeholder.com/200'}" alt="${rightProduct.title}">
                    <p>${rightProduct.title}</p>
                `;
            }
        }

        function nextSlide() {
            productItems[0].classList.replace("left", "inactive");
            productItems[1].classList.replace("active", "left");
            productItems[2].classList.replace("right", "active");

            setTimeout(() => {
                currentIndex = (currentIndex + 1) % productsData.length;
                updateSlider();
            }, 800); // Чекаємо завершення анімації перед оновленням
        }

        function restartAutoSlide() {
            clearInterval(autoSlideInterval);
            updateSlider();
            autoSlideInterval = setInterval(nextSlide, 5000);
        }

        updateSlider();
        autoSlideInterval = setInterval(nextSlide, 5000);
    });
</script>
