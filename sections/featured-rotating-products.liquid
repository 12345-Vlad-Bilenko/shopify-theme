<div id="product-slider">
    <p>Number of products: {{ collections.all.products.size }}</p>
    <div class="slider-container">
        <div class="product-item inactive left"></div>
        <div class="product-item active"></div>
        <div class="product-item inactive right"></div>
    </div>
</div>

<style>
    #product-slider {
        text-align: center;
        position: relative;
        max-width: 900px;
        margin: 0 auto;
    }

    .slider-container {
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
    }

    .product-item {
        width: 300px;
        height: 400px; /* Фіксована висота */
        text-align: center;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #f9f9f9;
        margin: 0 10px;
        cursor: pointer;
        transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out, width 0.5s ease-in-out;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .product-item.active {
        opacity: 1;
        width: 300px;
        transform: scale(1);
    }

    .product-item.inactive {
        opacity: 0.5;
        width: 200px;
        transform: scale(0.8);
    }

    .product-item img {
        max-width: 100%;
        height: 200px; /* Фіксована висота для всіх картинок */
        object-fit: cover; /* Гарантує, що всі картинки однакового розміру */
        border-radius: 10px;
    }

    .product-item p {
        margin: 10px 0;
    }

    .btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const productItems = document.querySelectorAll('.product-item');
        const productsData = {{ collections.all.products | json }};
        let currentIndex = 0;
        let autoSlideInterval;

        function updateSlider() {
            productItems.forEach(item => {
                item.innerHTML = '';
                item.className = 'product-item inactive';
            });

            let leftIndex = (currentIndex - 1 + productsData.length) % productsData.length;
            let activeIndex = currentIndex;
            let rightIndex = (currentIndex + 1) % productsData.length;

            let leftProduct = productsData[leftIndex];
            if (leftProduct) {
                const leftItem = productItems[0];
                leftItem.classList.add('left');
                leftItem.innerHTML = `
                    <img src="${leftProduct.featured_image || 'https://via.placeholder.com/200'}" alt="${leftProduct.title}">
                    <p>${leftProduct.title}</p>
                `;
                leftItem.addEventListener('click', () => {
                    currentIndex = leftIndex;
                    restartAutoSlide();
                });
            }

            let activeProduct = productsData[activeIndex];
            if (activeProduct) {
                const activeItem = productItems[1];
                activeItem.classList.remove('inactive');
                activeItem.classList.add('active');
                activeItem.innerHTML = `
                    <img src="${activeProduct.featured_image || 'https://via.placeholder.com/200'}" alt="${activeProduct.title}">
                    <p>${activeProduct.title}</p>
                    <p>${activeProduct.price}</p>
                    <a href="${activeProduct.url}" class="btn btn-primary">View Product</a>
                `;
            }

            let rightProduct = productsData[rightIndex];
            if (rightProduct) {
                const rightItem = productItems[2];
                rightItem.classList.add('right');
                rightItem.innerHTML = `
                    <img src="${rightProduct.featured_image || 'https://via.placeholder.com/200'}" alt="${rightProduct.title}">
                    <p>${rightProduct.title}</p>
                `;
                rightItem.addEventListener('click', () => {
                    currentIndex = rightIndex;
                    restartAutoSlide();
                });
            }
        }

        function nextSlide() {
            currentIndex = (currentIndex + 1) % productsData.length;
            updateSlider();
        }

        function restartAutoSlide() {
            clearInterval(autoSlideInterval);
            updateSlider();
            autoSlideInterval = setInterval(nextSlide, 5000);
        }

        updateSlider();
        autoSlideInterval = setInterval(nextSlide, 5000);
    });
</script>
