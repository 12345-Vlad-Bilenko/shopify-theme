<div id="product-slider">
    <p>Number of products: {{ collections.all.products.size }}</p>
    <div class="slider-container">
        <div class="product-item inactive left">
            </div>
        <div class="product-item active">
            </div>
        <div class="product-item inactive right">
            </div>
    </div>
</div>

<style>
    #product-slider {
        text-align: center;
        position: relative;
        max-width: 900px;
        margin: 0 auto;
        overflow: hidden; /* Додано для приховування елементів за межами контейнера */
    }

    .slider-container {
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        transition: transform 0.5s ease-in-out; /* Анімація для переміщення контейнера */
    }

    .product-item {
        width: 300px;
        min-height: 300px; /* Фіксована мінімальна висота для всіх карток */
        text-align: center;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #f9f9f9;
        margin: 0 10px;
        cursor: pointer;
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, width 0.3s ease-in-out;
        box-sizing: border-box; /* Враховуємо padding та border у ширині */
    }

    .product-item.active {
        opacity: 1;
        width: 300px;
        transform: scale(1);
    }

    .product-item.inactive {
        opacity: 0.5;
        width: 200px;
        transform: scale(0.8);
    }

    .product-item.left {
        /* Додаткові стилі для лівого неактивного елемента */
    }

    .product-item.right {
        /* Додаткові стилі для правого неактивного елемента */
    }

    .product-item img {
        max-width: 100%;
        max-height: 150px; /* Обмежуємо висоту зображення */
        height: auto;
        border-radius: 10px;
        object-fit: contain; /* Гарантуємо, що зображення повністю вміститься */
    }

    .product-item p {
        margin: 10px 0;
    }

    .btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const productSlider = document.getElementById('product-slider');
        const sliderContainer = productSlider.querySelector('.slider-container');
        const productItems = document.querySelectorAll('.product-item');
        const productsData = {{ collections.all.products | json }};
        let currentIndex = 0;
        let autoSlideInterval;

        function updateSlider() {
            // Очищаємо вміст елементів
            productItems.forEach(item => {
                item.innerHTML = '';
                item.className = 'product-item inactive';
            });

            // Визначаємо індекси продуктів для відображення
            let leftIndex = (currentIndex - 1 + productsData.length) % productsData.length;
            let activeIndex = currentIndex;
            let rightIndex = (currentIndex + 1) % productsData.length;

            // Заповнюємо лівий елемент
            let leftProduct = productsData[leftIndex];
            if (leftProduct) {
                const leftItem = productItems[0];
                leftItem.classList.add('left');
                leftItem.innerHTML = `
                    ${leftProduct.featured_image ? `<img src="${leftProduct.featured_image}" alt="${leftProduct.title}">` : '<div class="placeholder-image">No Image</div>'}
                    <p>${leftProduct.title}</p>
                `;
                leftItem.addEventListener('click', () => {
                    stopAutoSlide();
                    currentIndex = leftIndex;
                    updateSlider();
                    startAutoSlide();
                });
            }

            // Заповнюємо активний елемент
            let activeProduct = productsData[activeIndex];
            if (activeProduct) {
                const activeItem = productItems[1];
                activeItem.classList.remove('inactive');
                activeItem.classList.add('active');
                activeItem.innerHTML = `
                    ${activeProduct.featured_image ? `<img src="${activeProduct.featured_image}" alt="${activeProduct.title}">` : '<div class="placeholder-image">No Image</div>'}
                    <p>${activeProduct.title}</p>
                    <p>${activeProduct.price}</p>
                    <a href="${activeProduct.url}" class="btn btn-primary">View Product</a>
                `;
            }

            // Заповнюємо правий елемент
            let rightProduct = productsData[rightIndex];
            if (rightProduct) {
                const rightItem = productItems[2];
                rightItem.classList.add('right');
                rightItem.innerHTML = `
                    ${rightProduct.featured_image ? `<img src="${rightProduct.featured_image}" alt="${rightProduct.title}">` : '<div class="placeholder-image">No Image</div>'}
                    <p>${rightProduct.title}</p>
                `;
                rightItem.addEventListener('click', () => {
                    stopAutoSlide();
                    currentIndex = rightIndex;
                    updateSlider();
                    startAutoSlide();
                });
            }

            // Анімація переміщення контейнера
            const translateXValue = -currentIndex * 320; // 300px ширина + 20px margin
            sliderContainer.style.transform = `translateX(${translateXValue}px)`;
        }

        function nextProduct() {
            currentIndex = (currentIndex + 1) % productsData.length;
            updateSlider();
        }

        function startAutoSlide() {
            autoSlideInterval = setInterval(nextProduct, 5000);
        }

        function stopAutoSlide() {
            clearInterval(autoSlideInterval);
        }

        // Ініціалізація слайдера
        updateSlider();
        startAutoSlide();

        // Додаємо стилі для плейсхолдера зображення
        const style = document.createElement('style');
        style.innerHTML = `
            .placeholder-image {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 150px;
                background-color: #eee;
                border-radius: 10px;
                font-size: 14px;
                color: #777;
            }
        `;
        document.head.appendChild(style);
    });
</script>